import{c1 as d,c2 as m,c3 as u,c4 as p,c5 as c,bl as b,r as a,c6 as v,c7 as f,c as y,j as h}from"./index.js";var x=class extends d{#s;#i=void 0;#t;#e;constructor(s,t){super(),this.#s=s,this.setOptions(t),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(s){const t=this.options;this.options=this.#s.defaultMutationOptions(s),m(this.options,t)||this.#s.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#t,observer:this}),t?.mutationKey&&this.options.mutationKey&&u(t.mutationKey)!==u(this.options.mutationKey)?this.reset():this.#t?.state.status==="pending"&&this.#t.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#t?.removeObserver(this)}onMutationUpdate(s){this.#r(),this.#o(s)}getCurrentResult(){return this.#i}reset(){this.#t?.removeObserver(this),this.#t=void 0,this.#r(),this.#o()}mutate(s,t){return this.#e=t,this.#t?.removeObserver(this),this.#t=this.#s.getMutationCache().build(this.#s,this.options),this.#t.addObserver(this),this.#t.execute(s)}#r(){const s=this.#t?.state??p();this.#i={...s,isPending:s.status==="pending",isSuccess:s.status==="success",isError:s.status==="error",isIdle:s.status==="idle",mutate:this.mutate,reset:this.reset}}#o(s){c.batch(()=>{if(this.#e&&this.hasListeners()){const t=this.#i.variables,r=this.#i.context,i={client:this.#s,meta:this.options.meta,mutationKey:this.options.mutationKey};if(s?.type==="success"){try{this.#e.onSuccess?.(s.data,t,r,i)}catch(e){Promise.reject(e)}try{this.#e.onSettled?.(s.data,null,t,r,i)}catch(e){Promise.reject(e)}}else if(s?.type==="error"){try{this.#e.onError?.(s.error,t,r,i)}catch(e){Promise.reject(e)}try{this.#e.onSettled?.(void 0,s.error,t,r,i)}catch(e){Promise.reject(e)}}}this.listeners.forEach(t=>{t(this.#i)})})}};function g(s,t){const r=b(),[i]=a.useState(()=>new x(r,s));a.useEffect(()=>{i.setOptions(s)},[i,s]);const e=a.useSyncExternalStore(a.useCallback(n=>i.subscribe(c.batchCalls(n)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),o=a.useCallback((n,l)=>{i.mutate(n,l).catch(v)},[i]);if(e.error&&f(i.options.throwOnError,[e.error]))throw e.error;return{...e,mutate:o,mutateAsync:e.mutate}}function E(s){const t=y.c(7),{msg:r,error:i}=s;let e;t[0]!==r?(e=r&&h.jsx("h2",{className:"text-destructive text-sm",children:r}),t[0]=r,t[1]=e):e=t[1];let o;t[2]!==i?(o=i&&h.jsx("p",{className:"text-destructive text-sm",children:i.message}),t[2]=i,t[3]=o):o=t[3];let n;return t[4]!==e||t[5]!==o?(n=h.jsxs("div",{className:"mb-6 max-w-4xl rounded-md border border-destructive bg-destructive/10 p-4",children:[e,o]}),t[4]=e,t[5]=o,t[6]=n):n=t[6],n}export{E,g as u};
