import{h as $,aM as I,aN as q,aO as G,aP as V,aQ as W,aR as Q,c as B,j as t,L as Z,r as F,aS as J,aT as X,B as Y}from"./index.js";import{a as ee,b as te,c as se,e as ae,d as ne,h as le,f as oe,g as ie}from"./alert-dialog.js";import{g as re,a as ce,b as de,c as me}from"./s3.js";import{D as ue}from"./download.js";import{T as fe}from"./trash-2.js";const he=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}]],pe=$("file",he);const ge=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],xe=$("folder",ge);const be=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],ye=$("upload",be),je=c=>(e,a)=>async n=>{const l=await e(n),{response:s}=l;if(I.isInstance(s)&&s.headers.expires){s.headers.expiresstring=s.headers.expires;try{q(s.headers.expires)}catch(o){a.logger?.warn(`AWS SDK Warning for ${a.clientName}::${a.commandName} response parsing (${s.headers.expires}): ${o}`),delete s.headers.expires}}return l},ke={tags:["S3"],name:"s3ExpiresMiddleware",override:!0,relation:"after",toMiddleware:"deserializerMiddleware"},Ne=c=>({applyToStack:e=>{e.addRelativeTo(je(),ke)}});class Ce extends G.classBuilder().ep({...V,Bucket:{type:"contextParams",name:"Bucket"},Key:{type:"contextParams",name:"Key"}}).m(function(e,a,n,l){return[W(n,e.getEndpointParameterInstructions()),re(n,{requestChecksumRequired:!1,requestValidationModeMember:"ChecksumMode",responseAlgorithms:["CRC64NVME","CRC32","CRC32C","SHA256","SHA1"]}),ce(n),Ne()]}).s("AmazonS3","GetObject",{}).n("S3Client","GetObjectCommand").sc(Q).build(){}function Ae(c){const e=B.c(9),{folderName:a,fullPrefix:n,bucketName:l}=c;let s;e[0]!==l||e[1]!==n?(s={bucket:l,_splat:n},e[0]=l,e[1]=n,e[2]=s):s=e[2];let o;e[3]===Symbol.for("react.memo_cache_sentinel")?(o=t.jsx(xe,{className:"size-5 text-muted-foreground"}),e[3]=o):o=e[3];let i;e[4]!==a?(i=t.jsx("span",{className:"font-medium",children:a}),e[4]=a,e[5]=i):i=e[5];let r;return e[6]!==s||e[7]!==i?(r=t.jsxs(Z,{className:"flex items-center gap-3 rounded-lg border bg-card p-4 transition-colors hover:bg-accent",params:s,to:"/s3/ls/$bucket/$",children:[o,i]}),e[6]=s,e[7]=i,e[8]=r):r=e[8],r}function _e(c){const e=B.c(46),{object:a,bucketName:n,displayName:l,fullKey:s}=c,[o,i]=F.useState(!1),r=de();let N;e[0]!==n||e[1]!==l||e[2]!==s?(N=async function(){try{const K=new Ce({Bucket:n,Key:s}),z=await X().send(K);if(z.Body){const H=await z.Body.transformToByteArray(),E=URL.createObjectURL(new Blob([H])),k=document.createElement("a");k.href=E,k.download=l,document.body.appendChild(k),k.click(),document.body.removeChild(k),URL.revokeObjectURL(E)}}catch{throw new Error("Failed to download object")}},e[0]=n,e[1]=l,e[2]=s,e[3]=N):N=e[3];const L=N;let C;e[4]!==n||e[5]!==r||e[6]!==s?(C=async function(){await r.mutateAsync({bucket:n,key:s}),i(!1)},e[4]=n,e[5]=r,e[6]=s,e[7]=C):C=e[7];const O=C,U=a.Key;let w;e[8]===Symbol.for("react.memo_cache_sentinel")?(w=t.jsx(pe,{className:"size-5 text-muted-foreground"}),e[8]=w):w=e[8];let d;e[9]!==l?(d=t.jsx("h3",{className:"font-medium",children:l}),e[9]=l,e[10]=d):d=e[10];let m;e[11]!==a.LastModified?(m=a.LastModified&&t.jsxs("p",{className:"text-muted-foreground text-sm",children:["Last Modified: ",a.LastModified.toLocaleString()]}),e[11]=a.LastModified,e[12]=m):m=e[12];let u;e[13]!==d||e[14]!==m?(u=t.jsxs("div",{className:"flex items-center gap-3",children:[w,t.jsxs("div",{children:[d,m]})]}),e[13]=d,e[14]=m,e[15]=u):u=e[15];const R=a.Size||0;let f;e[16]!==R?(f=J(R),e[16]=R,e[17]=f):f=e[17];let h;e[18]!==f?(h=t.jsx("div",{className:"text-muted-foreground text-sm",children:f}),e[18]=f,e[19]=h):h=e[19];let S;e[20]===Symbol.for("react.memo_cache_sentinel")?(S=t.jsx(ue,{className:"size-4"}),e[20]=S):S=e[20];let p;e[21]!==L?(p=t.jsx("button",{className:"rounded-md p-2 transition-colors hover:bg-accent",onClick:L,type:"button",children:S}),e[21]=L,e[22]=p):p=e[22];let v;e[23]===Symbol.for("react.memo_cache_sentinel")?(v=()=>i(!0),e[23]=v):v=e[23];let D;e[24]===Symbol.for("react.memo_cache_sentinel")?(D=t.jsx("button",{className:"rounded-md p-2 text-destructive transition-colors hover:bg-accent",onClick:v,type:"button",children:t.jsx(fe,{className:"size-4"})}),e[24]=D):D=e[24];let g;e[25]!==h||e[26]!==p?(g=t.jsxs("div",{className:"flex items-center gap-3",children:[h,p,D]}),e[25]=h,e[26]=p,e[27]=g):g=e[27];let M;e[28]===Symbol.for("react.memo_cache_sentinel")?(M=t.jsx(ee,{children:"Delete Object"}),e[28]=M):M=e[28];let x;e[29]!==l?(x=t.jsxs(te,{children:[M,t.jsxs(se,{children:["Are you sure you want to delete ",t.jsx("strong",{children:l}),"? This action cannot be undone."]})]}),e[29]=l,e[30]=x):x=e[30];let A;e[31]===Symbol.for("react.memo_cache_sentinel")?(A=t.jsx(ae,{children:"Cancel"}),e[31]=A):A=e[31];const P=r.isPending?"Deleting…":"Delete";let b;e[32]!==O||e[33]!==P?(b=t.jsxs(ne,{children:[A,t.jsx(le,{className:"bg-destructive hover:bg-destructive/90",onClick:O,children:P})]}),e[32]=O,e[33]=P,e[34]=b):b=e[34];let y;e[35]!==x||e[36]!==b?(y=t.jsxs(oe,{children:[x,b]}),e[35]=x,e[36]=b,e[37]=y):y=e[37];let j;e[38]!==o||e[39]!==y?(j=t.jsx(ie,{onOpenChange:i,open:o,children:y}),e[38]=o,e[39]=y,e[40]=j):j=e[40];let _;return e[41]!==a.Key||e[42]!==g||e[43]!==j||e[44]!==u?(_=t.jsxs("div",{className:"flex items-center justify-between rounded-lg border bg-card p-4",children:[u,g,j]},U),e[41]=a.Key,e[42]=g,e[43]=j,e[44]=u,e[45]=_):_=e[45],_}function Le({bucket:c,prefix:e=""}){const a=F.useRef(null),n=me();async function l(s){const o=s.target.files;if(!(!o||o.length===0))try{await Promise.all(Array.from(o).map(i=>{const r=`${e}${i.name}`;return n.mutateAsync({bucket:c,key:r,file:i})}))}finally{a.current&&(a.current.value="")}}return t.jsxs(t.Fragment,{children:[t.jsx("input",{accept:"*/*",className:"hidden",multiple:!0,onChange:l,ref:a,type:"file"}),t.jsxs(Y,{disabled:n.isPending,onClick:()=>a.current?.click(),size:"sm",children:[t.jsx(ye,{className:"mr-2 size-4"}),n.isPending?"Uploading…":"Upload Files"]})]})}export{Ae as F,_e as O,Le as U};
