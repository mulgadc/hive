import{h as B,aL as G,aM as V,aN as W,aO as Q,aP as Z,aQ as J,c as U,j as t,L as X,r as K,aR as Y,aS as ee,B as te}from"./index.js";import{E as se}from"./error-banner.js";import{a as ae,b as le,c as oe,e as re,d as ne,h as ie,f as ce,g as de}from"./alert-dialog.js";import{g as me,b as fe,c as ue}from"./s3.js";import{D as he}from"./download.js";import{T as pe}from"./trash-2.js";const xe=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}]],ge=B("file",xe);const be=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],je=B("folder",be);const ye=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],ke=B("upload",ye),Ce=c=>(e,l)=>async o=>{const a=await e(o),{response:s}=a;if(G.isInstance(s)&&s.headers.expires){s.headers.expiresstring=s.headers.expires;try{V(s.headers.expires)}catch(i){l.logger?.warn(`AWS SDK Warning for ${l.clientName}::${l.commandName} response parsing (${s.headers.expires}): ${i}`),delete s.headers.expires}}return a},Ne={tags:["S3"],name:"s3ExpiresMiddleware",override:!0,relation:"after",toMiddleware:"deserializerMiddleware"},we=c=>({applyToStack:e=>{e.addRelativeTo(Ce(),Ne)}});class Se extends W.classBuilder().ep({...Q,Bucket:{type:"contextParams",name:"Bucket"},Key:{type:"contextParams",name:"Key"}}).m(function(e,l,o,a){return[Z(o,e.getEndpointParameterInstructions()),me(o,{requestChecksumRequired:!1,requestValidationModeMember:"ChecksumMode",responseAlgorithms:["CRC64NVME","CRC32","CRC32C","SHA256","SHA1"]}),fe(o),we()]}).s("AmazonS3","GetObject",{}).n("S3Client","GetObjectCommand").sc(J).build(){}function Re(c){const e=U.c(9),{folderName:l,fullPrefix:o,bucketName:a}=c;let s;e[0]!==a||e[1]!==o?(s={bucket:a,_splat:o},e[0]=a,e[1]=o,e[2]=s):s=e[2];let i;e[3]===Symbol.for("react.memo_cache_sentinel")?(i=t.jsx(je,{className:"size-5 text-muted-foreground"}),e[3]=i):i=e[3];let n;e[4]!==l?(n=t.jsx("span",{className:"font-medium",children:l}),e[4]=l,e[5]=n):n=e[5];let r;return e[6]!==s||e[7]!==n?(r=t.jsxs(X,{className:"flex items-center gap-3 rounded-lg border bg-card p-4 transition-colors hover:bg-accent",params:s,to:"/s3/ls/$bucket/$",children:[i,n]}),e[6]=s,e[7]=n,e[8]=r):r=e[8],r}function Oe(c){const e=U.c(51),{object:l,bucketName:o,displayName:a,fullKey:s}=c,[i,n]=K.useState(!1),r=ue();let d;e[0]!==o||e[1]!==a||e[2]!==s?(d=async function(){try{const I=new Se({Bucket:o,Key:s}),F=await ee().send(I);if(F.Body){const q=await F.Body.transformToByteArray(),P=URL.createObjectURL(new Blob([q])),w=document.createElement("a");w.href=P,w.download=a,document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(P)}}catch{throw new Error("Failed to download object")}},e[0]=o,e[1]=a,e[2]=s,e[3]=d):d=e[3];const O=d;let S;e[4]!==o||e[5]!==r||e[6]!==s?(S=async function(){await r.mutateAsync({bucket:o,key:s}),n(!1)},e[4]=o,e[5]=r,e[6]=s,e[7]=S):S=e[7];const E=S,T=l.Key;let m;e[8]!==r.error?(m=r.error&&t.jsx(se,{error:r.error,msg:"Failed to delete object"}),e[8]=r.error,e[9]=m):m=e[9];let v;e[10]===Symbol.for("react.memo_cache_sentinel")?(v=t.jsx(ge,{className:"size-5 text-muted-foreground"}),e[10]=v):v=e[10];let f;e[11]!==a?(f=t.jsx("h3",{className:"font-medium",children:a}),e[11]=a,e[12]=f):f=e[12];let u;e[13]!==l.LastModified?(u=l.LastModified&&t.jsxs("p",{className:"text-muted-foreground text-sm",children:["Last Modified: ",l.LastModified.toLocaleString()]}),e[13]=l.LastModified,e[14]=u):u=e[14];let h;e[15]!==f||e[16]!==u?(h=t.jsxs("div",{className:"flex items-center gap-3",children:[v,t.jsxs("div",{children:[f,u]})]}),e[15]=f,e[16]=u,e[17]=h):h=e[17];const $=l.Size||0;let p;e[18]!==$?(p=Y($),e[18]=$,e[19]=p):p=e[19];let x;e[20]!==p?(x=t.jsx("div",{className:"text-muted-foreground text-sm",children:p}),e[20]=p,e[21]=x):x=e[21];let D;e[22]===Symbol.for("react.memo_cache_sentinel")?(D=t.jsx(he,{className:"size-4"}),e[22]=D):D=e[22];let g;e[23]!==O?(g=t.jsx("button",{className:"rounded-md p-2 transition-colors hover:bg-accent",onClick:O,type:"button",children:D}),e[23]=O,e[24]=g):g=e[24];let M;e[25]===Symbol.for("react.memo_cache_sentinel")?(M=()=>n(!0),e[25]=M):M=e[25];let _;e[26]===Symbol.for("react.memo_cache_sentinel")?(_=t.jsx("button",{className:"rounded-md p-2 text-destructive transition-colors hover:bg-accent",onClick:M,type:"button",children:t.jsx(pe,{className:"size-4"})}),e[26]=_):_=e[26];let b;e[27]!==x||e[28]!==g?(b=t.jsxs("div",{className:"flex items-center gap-3",children:[x,g,_]}),e[27]=x,e[28]=g,e[29]=b):b=e[29];let A;e[30]===Symbol.for("react.memo_cache_sentinel")?(A=t.jsx(ae,{children:"Delete Object"}),e[30]=A):A=e[30];let j;e[31]!==a?(j=t.jsxs(le,{children:[A,t.jsxs(oe,{children:["Are you sure you want to delete ",t.jsx("strong",{children:a}),"? This action cannot be undone."]})]}),e[31]=a,e[32]=j):j=e[32];let L;e[33]===Symbol.for("react.memo_cache_sentinel")?(L=t.jsx(re,{children:"Cancel"}),e[33]=L):L=e[33];const z=r.isPending?"Deleting…":"Delete";let y;e[34]!==E||e[35]!==z?(y=t.jsxs(ne,{children:[L,t.jsx(ie,{className:"bg-destructive hover:bg-destructive/90",onClick:E,children:z})]}),e[34]=E,e[35]=z,e[36]=y):y=e[36];let k;e[37]!==j||e[38]!==y?(k=t.jsxs(ce,{children:[j,y]}),e[37]=j,e[38]=y,e[39]=k):k=e[39];let C;e[40]!==i||e[41]!==k?(C=t.jsx(de,{onOpenChange:n,open:i,children:k}),e[40]=i,e[41]=k,e[42]=C):C=e[42];let N;e[43]!==b||e[44]!==C||e[45]!==h?(N=t.jsxs("div",{className:"flex items-center justify-between rounded-lg border bg-card p-4",children:[h,b,C]}),e[43]=b,e[44]=C,e[45]=h,e[46]=N):N=e[46];let R;return e[47]!==l.Key||e[48]!==N||e[49]!==m?(R=t.jsxs("div",{children:[m,N]},T),e[47]=l.Key,e[48]=N,e[49]=m,e[50]=R):R=e[50],R}function Ee({bucket:c,prefix:e="",isPending:l,onUpload:o}){const a=K.useRef(null);async function s(i){const n=i.target.files;if(!(!n||n.length===0))try{await Promise.all(Array.from(n).map(r=>{const d=`${e}${r.name}`;return o({bucket:c,key:d,file:r})}))}finally{a.current&&(a.current.value="")}}return t.jsxs(t.Fragment,{children:[t.jsx("input",{accept:"*/*","aria-label":"Choose files to upload",className:"hidden",multiple:!0,onChange:s,ref:a,type:"file"}),t.jsxs(te,{disabled:l,onClick:()=>a.current?.click(),size:"sm",children:[t.jsx(ke,{className:"mr-2 size-4"}),l?"Uploading…":"Upload Files"]})]})}export{Re as F,Oe as O,Ee as U};
