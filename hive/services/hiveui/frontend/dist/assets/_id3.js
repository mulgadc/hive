import{k as O,av as Z,u as q,an as G,x as J,r as m,j as e,B as u,L as y,aw as z,ax as U,ay as w}from"./index.js";import{u as B}from"./useSuspenseQuery.js";import{B as M}from"./back-link.js";import{D as l,a as s}from"./detail-row.js";import{E as D}from"./error-banner.js";import{P as W}from"./page-heading.js";import{S as X}from"./state-badge.js";import{g as f,f as A,b,a as V,c as k,d as C,e as S,h as N}from"./alert-dialog.js";import{b as P,a as E}from"./field.js";import{I as ee}from"./input.js";import{S as ae,a as te,b as se,c as ne,d as le}from"./select.js";import{i as ie,j as ce,k as oe}from"./ec2.js";import{T as re}from"./trash-2.js";import"./check.js";const de=[["path",{d:"M9 17H7A5 5 0 0 1 7 7",key:"10o201"}],["path",{d:"M15 7h2a5 5 0 0 1 4 8",key:"1d3206"}],["line",{x1:"8",x2:"12",y1:"12",y2:"12",key:"rvw6j4"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]],he=O("link-2-off",de);const me=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],ue=O("link-2",me);function Se(){const{id:r}=Z.useParams(),H=q(),{data:L}=B(G(r)),{data:R}=B(J),t=L.Volumes?.[0],i=ie(),c=ce(),o=oe(),[x,d]=m.useState(null),[j,v]=m.useState(""),[T,p]=m.useState(""),[F,g]=m.useState(!1),K=R.Reservations?.flatMap(a=>a.Instances?.filter(h=>h.State?.Name==="running")??[])??[],I=t?.State==="available"&&(!t.Attachments||t.Attachments.length===0),n=()=>d(null),$=async()=>{try{await i.mutateAsync(r),H({to:"/ec2/describe-volumes"})}finally{n()}},_=async()=>{try{await c.mutateAsync({volumeId:r,instanceId:j,device:T||void 0}),n(),v(""),p("")}catch{}},Q=async()=>{const a=t?.Attachments?.[0]?.InstanceId;try{await o.mutateAsync({volumeId:r,instanceId:a||void 0,force:F||void 0}),n(),g(!1)}catch{}};return t?.VolumeId?e.jsxs(e.Fragment,{children:[e.jsx(M,{to:"/ec2/describe-volumes",children:"Back to volumes"}),i.error&&e.jsx(D,{error:i.error,msg:"Failed to delete volume"}),c.error&&e.jsx(D,{error:c.error,msg:"Failed to attach volume"}),o.error&&e.jsx(D,{error:o.error,msg:"Failed to detach volume"}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(W,{actions:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(u,{disabled:!I,onClick:()=>d("delete"),size:"sm",variant:"destructive",children:[e.jsx(re,{className:"size-4"}),"Delete"]}),I?e.jsx(y,{className:z({variant:"outline"}),params:{id:t.VolumeId},to:"/ec2/modify-volume/$id",children:"Resize Volume"}):e.jsx(u,{disabled:!0,variant:"outline",children:"Resize Volume"}),I?e.jsxs(u,{onClick:()=>d("attach"),size:"sm",variant:"outline",children:[e.jsx(ue,{className:"size-4"}),"Attach"]}):null,t.Attachments&&t.Attachments.length>0?e.jsxs(u,{onClick:()=>d("detach"),size:"sm",variant:"outline",children:[e.jsx(he,{className:"size-4"}),"Detach"]}):null,e.jsxs(y,{className:z({variant:"outline",size:"sm"}),search:{volumeId:t.VolumeId},to:"/ec2/create-snapshot",children:[e.jsx(U,{className:"size-4"}),"Create Snapshot"]}),e.jsx(X,{state:t.State})]}),subtitle:"EC2 Volume Details",title:t.VolumeId}),e.jsxs(l,{children:[e.jsx(l.Header,{children:"Volume Information"}),e.jsxs(l.Content,{children:[e.jsx(s,{label:"Volume ID",value:t.VolumeId}),e.jsx(s,{label:"Size",value:`${t.Size} GiB`}),e.jsx(s,{label:"Volume Type",value:t.VolumeType}),e.jsx(s,{label:"State",value:t.State}),e.jsx(s,{label:"Availability Zone",value:t.AvailabilityZone}),e.jsx(s,{label:"Create Time",value:w(t.CreateTime)}),e.jsx(s,{label:"Encrypted",value:t.Encrypted?"Yes":"No"}),e.jsx(s,{label:"KMS Key ID",value:t.KmsKeyId})]})]}),t.Attachments&&t.Attachments.length>0&&e.jsxs(l,{children:[e.jsx(l.Header,{children:"Attachments"}),t.Attachments.map(a=>e.jsxs(l.Content,{children:[e.jsx(s,{label:"Instance ID",value:a.InstanceId?e.jsx(y,{className:"text-primary hover:underline",params:{id:a.InstanceId},to:"/ec2/describe-instances/$id",children:a.InstanceId}):void 0}),e.jsx(s,{label:"Device",value:a.Device}),e.jsx(s,{label:"Status",value:a.State}),e.jsx(s,{label:"Attach Time",value:w(a.AttachTime)}),e.jsx(s,{label:"Delete on Termination",value:a.DeleteOnTermination?"Yes":"No"})]},a.InstanceId))]})]}),e.jsx(f,{onOpenChange:a=>{a||n()},open:x==="delete",children:e.jsxs(A,{children:[e.jsxs(b,{children:[e.jsx(V,{children:"Delete Volume"}),e.jsxs(k,{children:['Are you sure you want to delete the volume "',t.VolumeId,'"? This action cannot be undone.']})]}),e.jsxs(C,{children:[e.jsx(S,{children:"Cancel"}),e.jsx(N,{disabled:i.isPending,onClick:$,children:i.isPending?"Deleting…":"Delete"})]})]})}),e.jsx(f,{onOpenChange:a=>{a||(n(),v(""),p(""))},open:x==="attach",children:e.jsxs(A,{children:[e.jsxs(b,{children:[e.jsx(V,{children:"Attach Volume"}),e.jsx(k,{children:"Attach this volume to a running instance."})]}),e.jsxs(P,{children:[e.jsx(E,{children:e.jsx("label",{htmlFor:"attachInstance",children:"Instance"})}),e.jsxs(ae,{onValueChange:a=>v(a??""),value:j,children:[e.jsx(te,{className:"w-full",id:"attachInstance",children:e.jsx(se,{placeholder:"Select an instance"})}),e.jsx(ne,{children:K.map(a=>{const h=a.Tags?.find(Y=>Y.Key==="Name")?.Value;return e.jsxs(le,{value:a.InstanceId??"",children:[a.InstanceId,h?` (${h})`:""]},a.InstanceId)})})]})]}),e.jsxs(P,{children:[e.jsx(E,{children:e.jsx("label",{htmlFor:"attachDevice",children:"Device (optional)"})}),e.jsx(ee,{id:"attachDevice",onChange:a=>p(a.target.value),placeholder:"/dev/sdf",value:T})]}),e.jsxs(C,{children:[e.jsx(S,{children:"Cancel"}),e.jsx(N,{disabled:c.isPending||!j,onClick:_,children:c.isPending?"Attaching…":"Attach"})]})]})}),e.jsx(f,{onOpenChange:a=>{a||(n(),g(!1))},open:x==="detach",children:e.jsxs(A,{children:[e.jsxs(b,{children:[e.jsx(V,{children:"Detach Volume"}),e.jsxs(k,{children:['Are you sure you want to detach the volume "',t.VolumeId,'" from instance "',t.Attachments?.[0]?.InstanceId,'"?']})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{checked:F,onChange:a=>g(a.target.checked),type:"checkbox"}),"Force detach"]}),e.jsxs(C,{children:[e.jsx(S,{children:"Cancel"}),e.jsx(N,{disabled:o.isPending,onClick:Q,children:o.isPending?"Detaching…":"Detach"})]})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{to:"/ec2/describe-volumes",children:"Back to volumes"}),e.jsx("p",{className:"text-muted-foreground",children:"Volume not found."})]})}export{Se as component};
