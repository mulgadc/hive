name: E2E Test Hive

on:
  push:
    branches: [ main, e2e ]
  workflow_dispatch:

jobs:
  hive_e2e_test:
    name: Hive E2E Test
    runs-on: self-hosted

    steps:
      - name: Pre-cleanup
        run: |
          echo "Cleaning up previous run data..."
          rm -rf ~/hive/* || true
          find . -maxdepth 1 ! -name '.git' ! -name '.' -exec rm -rf {} + || true

      - name: Checkout Code
        uses: actions/checkout@v6

      - name: Clone Dependencies
        run: ./scripts/clone-deps.sh

      - name: E2E Test (Docker)
        run: make e2e-test
